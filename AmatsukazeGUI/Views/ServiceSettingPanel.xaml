<UserControl x:Class="Amatsukaze.Views.ServiceSettingPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:l="http://schemas.livet-mvvm.net/2011/wpf"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:v="clr-namespace:Amatsukaze.Views"
             xmlns:vm="clr-namespace:Amatsukaze.ViewModels" 
             xmlns:m="clr-namespace:Amatsukaze.Models" 
             mc:Ignorable="d" 
             d:DesignHeight="600"
             d:DataContext="{d:DesignInstance {x:Type vm:ServiceSettingViewModel}}">

    <i:Interaction.Triggers>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}" MessageKey="FromServiceSetting">
            <l:TransitionInteractionMessageAction InvokeActionOnlyWhenWindowIsActive="False"/>
        </l:InteractionMessageTrigger>
    </i:Interaction.Triggers>

    <DockPanel>
        <DockPanel.Resources>
            <DataTemplate DataType="{x:Type m:DisplayLogo}">
                <v:LogoItem />
            </DataTemplate>
        </DockPanel.Resources>

        <DockPanel DockPanel.Dock="Bottom" HorizontalAlignment="Center">
            <DockPanel HorizontalAlignment="Center">
                <TextBlock DockPanel.Dock="Top" HorizontalAlignment="Center" 
                       Text="開始       ←ロゴファイル適用期間→      終了"/>
                <Calendar SelectedDate="{Binding SelectedLogoItem.From, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" VerticalContentAlignment="Bottom"
                  DisplayDate="{Binding SelectedLogoItem.From}"
                  SelectedDatesChanged="Calendar_SelectedDatesChanged"/>
                <Calendar SelectedDate="{Binding SelectedLogoItem.To, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                  DisplayDate="{Binding SelectedLogoItem.To}"
                  SelectedDatesChanged="Calendar_SelectedDatesChanged"/>
            </DockPanel>
            <Button Content="適用" Width="54" Height="28" Margin="5" HorizontalAlignment="Left" VerticalAlignment="Top"
                    IsEnabled="{Binding SelectedLogoItem.DateChanged}" Command="{Binding ApplyDateCommand}"/>
        </DockPanel>

        <DockPanel DockPanel.Dock="Top">
            <DockPanel DockPanel.Dock="Left">
                <TextBlock DockPanel.Dock="Top" HorizontalAlignment="Left" Margin="3" Text="サービス（チャンネル）"/>
                <ListBox ItemsSource="{Binding Model.ServiceSettings}" SelectedIndex="{Binding SelectedServiceIndex, Mode=TwoWay}">
                    <ListBox.ContextMenu>
                        <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                            <MenuItem Header="選択中のサービス設定を削除" Command="{Binding RemoveServiceSettingCommand}" />
                            <MenuItem Header="サービス設定を追加..." Command="{Binding AddServiceSettingCommand}" />
                        </ContextMenu>
                    </ListBox.ContextMenu>
                </ListBox>
            </DockPanel>

            <Border Width="6" DockPanel.Dock="Left"/>

            <GroupBox DockPanel.Dock="Top" Header="JoinLogoScpコマンドファイル" Tag="{DynamicResource AMT.BackgroundBaseBrush}">
                <DockPanel>
                    <ComboBox DockPanel.Dock="Top" HorizontalAlignment="Stretch" Margin="3"
                              ItemsSource="{Binding Model.JlsCommandFiles}"
                              Text="{Binding SelectedServiceItem.JlsCommandFile, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Height="22" VerticalAlignment="Top"/>
                    <DockPanel DockPanel.Dock="Top">
                        <TextBlock Text="オプション" VerticalAlignment="Center"/>
                        <TextBox Grid.Column="1" Margin="3" Text="{Binding SelectedServiceItem.JLSOption, Mode=TwoWay}" />
                    </DockPanel>
                </DockPanel>
            </GroupBox>

            <DockPanel DockPanel.Dock="Top">
                <Button Margin="2" DockPanel.Dock="Right" Width="160" Content="選択中の「ロゴなし」を削除" Command="{Binding RemoveNoLogoCommand}"/>
                <Button Margin="2" DockPanel.Dock="Right" Width="160" Content="「ロゴなし」を追加" Command="{Binding AddNoLogoCommand}"/>
                <TextBlock Text="ロゴファイル" Margin="3" VerticalAlignment="Center"/>
            </DockPanel>
            <ListBox ItemsSource="{Binding SelectedServiceItem.LogoList}" SelectedIndex="{Binding SelectedLogoIndex, Mode=TwoWay}"
                     Background="Transparent"
                     AllowDrop="True" PreviewDragEnter="LogoList_PreviewDragOver" PreviewDragOver="LogoList_PreviewDragOver" Drop="LogoList_Drop">
                <ListBox.ContextMenu>
                    <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                        <MenuItem Header="「ロゴなし」を追加" Command="{Binding AddNoLogoCommand}" />
                        <MenuItem Header="選択中の「ロゴなし」を削除" Command="{Binding RemoveNoLogoCommand}" />
                    </ContextMenu>
                </ListBox.ContextMenu>
            </ListBox>

        </DockPanel>

    </DockPanel>
</UserControl>
