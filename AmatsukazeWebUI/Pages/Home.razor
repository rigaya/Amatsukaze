@page "/info"
@using Amatsukaze.Shared
@inject IAmatsukazeApi Api

<h1>情報</h1>

@if (_loading)
{
    <p>Loading...</p>
}
else if (!string.IsNullOrEmpty(_error))
{
    <p style="color: red;">@_error</p>
}
else if (_system == null)
{
    <p>No data.</p>
}
else
{
    <table>
        <tr><th>Host</th><td>@(_system.ServerInfo?.HostName ?? "-")</td></tr>
        <tr><th>Version</th><td>@(_system.ServerInfo?.Version ?? "-")</td></tr>
        <tr><th>Platform</th><td>@(_system.ServerInfo?.Platform ?? "-")</td></tr>
        <tr><th>State</th><td>@(_system.StatusSummary?.RunningStateLabel ?? "-")</td></tr>
        <tr><th>Progress</th><td>@(_system.State?.Progress.ToString("P1") ?? "-")</td></tr>
    </table>
}

@code {
    private SystemSnapshot? _system;
    private string? _error;
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        await ReloadAsync();
        _loading = false;
    }

    private async Task ReloadAsync()
    {
        var res = await Api.GetSystemAsync();
        if (!res.Ok)
        {
            _error = res.Error ?? "Failed to load.";
            return;
        }
        _error = null;
        _system = res.Data;
    }
}
