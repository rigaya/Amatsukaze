FROM ubuntu:24.04

ARG DEBIAN_FRONTEND=noninteractive \
    OSVER=ubuntu2404 \
    LOCAL_USER_ID=1000 \
    LOCAL_GROUP_ID=1000 \
    AVISYNTHPLUS_DEB_NAME=https://github.com/rigaya/AviSynthCUDAFilters/releases/download/0.7.3/avisynth_3.7.5-1_amd64_Ubuntu24.04.deb

ENV LANG=ja_JP.UTF-8
ENV LC_ALL=ja_JP.UTF-8
ENV LC_CTYPE=ja_JP.UTF-8

RUN apt update \
    && apt-get install -y \
      sudo \
      wget \
      curl \
      software-properties-common \
      git \
      cmake \
      nasm \
      yasm \
      meson \
      ninja-build \
      pkg-config \
      checkinstall \
      autoconf \
      automake \
      libtool \
      libssl-dev \
      libz-dev \
      build-essential \
      locales \
    && locale-gen ja_JP.UTF-8 \
    && locale-gen en_US.UTF-8 \
    && update-locale LANG=ja_JP.UTF-8 \
    && add-apt-repository ppa:dotnet/backports \
    && apt update \
    && apt-get install -y dotnet-sdk-9.0 \
    && wget -q ${AVISYNTHPLUS_DEB_NAME} -O avisynth.deb \
    && apt-get install ./avisynth.deb \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* \
    && rm avisynth.deb

RUN useradd -u $LOCAL_USER_ID -m --user-group --shell /bin/bash rigaya
RUN groupmod -g $LOCAL_GROUP_ID rigaya
WORKDIR /home/rigaya
COPY . .
RUN chown -R rigaya:rigaya .
USER rigaya
    

